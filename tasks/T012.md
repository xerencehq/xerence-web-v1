# T012: Book Consultation Page

## Overview

**Task ID**: T012
**Phase**: 3 - Pages
**Priority**: Critical
**Dependencies**: T004, T005, T006, T007
**Estimated Complexity**: Medium

## Objective

Create the primary conversion page for booking a free consultation. This page features an inline Calendly embed, a fallback external link, explanation of what to expect, and an optional lightweight lead qualifier form.

---

## Prerequisites

Before starting this task:
1. Read `CLAUDE.md` for agent rules
2. Check `EXECUTION.md` - Ensure T004, T005, T006, T007 are `completed`
3. Mark this task as `in_progress` in `EXECUTION.md`
4. Read `SHARED_NOTES.md` for any relevant notes

---

## File Ownership

```
CREATE:
- src/app/book-consultation/page.tsx
- src/components/UI/ConsultationPage/CalendlyEmbed.tsx
- src/components/UI/ConsultationPage/WhatToExpect.tsx
- src/components/UI/ConsultationPage/LeadQualifier.tsx
- src/components/UI/ConsultationPage/styles.ts
- src/components/UI/ConsultationPage/ConsultationPage.test.tsx
- src/components/Common/CalendlyEmbed/index.tsx
- src/components/Common/CalendlyEmbed/CalendlyEmbed.test.tsx
```

---

## Page Structure

```
┌─────────────────────────────────────────────────────────────────┐
│ [Header]                                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                     PAGE HERO                                    │
│            "Book a Free Consultation"                            │
│     "Let's discuss how we can help bring your vision to life"   │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                                                          │   │
│   │              WHAT TO EXPECT SECTION                      │   │
│   │                                                          │   │
│   │  In this 30-minute call, we'll:                         │   │
│   │  ✓ Discuss your project goals and challenges            │   │
│   │  ✓ Explore potential technical approaches               │   │
│   │  ✓ Provide initial recommendations                      │   │
│   │  ✓ Answer any questions you have                        │   │
│   │                                                          │   │
│   │  No commitment required. Just a friendly conversation.   │   │
│   │                                                          │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                                                          │   │
│   │              LEAD QUALIFIER (Optional)                   │   │
│   │                                                          │   │
│   │  Help us prepare for our conversation:                   │   │
│   │                                                          │   │
│   │  Budget Range: [Select...]                               │   │
│   │  Project Overview: [                              ]      │   │
│   │                                                          │   │
│   │  (Optional - you can fill this out after booking)       │   │
│   │                                                          │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                                                          │   │
│   │               CALENDLY EMBED                             │   │
│   │                                                          │   │
│   │         [Calendly scheduling widget]                     │   │
│   │                                                          │   │
│   │   ───────────────────────────────────────────────────   │   │
│   │                                                          │   │
│   │   Having trouble? Book directly on Calendly →           │   │
│   │                                                          │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│ [Footer]                                                        │
└─────────────────────────────────────────────────────────────────┘
```

---

## Calendly Configuration

**Calendly URL**: `https://calendly.com/xerence/30min`

### Calendly Embed Component

#### `src/components/Common/CalendlyEmbed/index.tsx`
```typescript
'use client';

import React, { useEffect } from 'react';
import { CalendlyWrapper, FallbackLink } from './styles';

interface CalendlyEmbedProps {
  url: string;
  minHeight?: string;
  prefill?: {
    name?: string;
    email?: string;
    customAnswers?: Record<string, string>;
  };
}

declare global {
  interface Window {
    Calendly?: {
      initInlineWidget: (options: {
        url: string;
        parentElement: HTMLElement;
        prefill?: {
          name?: string;
          email?: string;
          customAnswers?: Record<string, string>;
        };
      }) => void;
    };
  }
}

const CalendlyEmbed: React.FC<CalendlyEmbedProps> = ({
  url,
  minHeight = '700px',
  prefill,
}) => {
  useEffect(() => {
    // Load Calendly widget script
    const script = document.createElement('script');
    script.src = 'https://assets.calendly.com/assets/external/widget.js';
    script.async = true;
    document.body.appendChild(script);

    script.onload = () => {
      const container = document.getElementById('calendly-inline-widget');
      if (container && window.Calendly) {
        window.Calendly.initInlineWidget({
          url,
          parentElement: container,
          prefill,
        });
      }
    };

    return () => {
      document.body.removeChild(script);
    };
  }, [url, prefill]);

  return (
    <CalendlyWrapper data-testid="calendly-embed">
      <div
        id="calendly-inline-widget"
        style={{ minWidth: '320px', height: minHeight }}
      />
      <FallbackLink>
        Having trouble?{' '}
        <a
          href={url}
          target="_blank"
          rel="noopener noreferrer"
        >
          Book directly on Calendly →
        </a>
      </FallbackLink>
    </CalendlyWrapper>
  );
};

export default CalendlyEmbed;
```

---

## Lead Qualifier Component

Non-blocking optional form to help prepare for the consultation.

#### `src/components/UI/ConsultationPage/LeadQualifier.tsx`
```typescript
'use client';

import React, { useState } from 'react';
import { motion } from 'framer-motion';
import { Select, TextArea, FormField } from '@/components/Forms';
import { Button } from '@/components/Common';
import { fadeInUpVariant } from '@/styles';
import {
  QualifierWrapper,
  QualifierHeader,
  QualifierForm,
  OptionalNote,
  SuccessNote,
} from './styles';

const BUDGET_OPTIONS = [
  { value: 'under-10k', label: 'Under $10,000' },
  { value: '10k-25k', label: '$10,000 - $25,000' },
  { value: '25k-50k', label: '$25,000 - $50,000' },
  { value: '50k-100k', label: '$50,000 - $100,000' },
  { value: 'over-100k', label: '$100,000+' },
  { value: 'not-sure', label: 'Not sure yet' },
];

const LeadQualifier: React.FC = () => {
  const [budget, setBudget] = useState('');
  const [overview, setOverview] = useState('');
  const [submitted, setSubmitted] = useState(false);

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    // Store in localStorage or send to backend
    localStorage.setItem('leadQualifier', JSON.stringify({ budget, overview }));
    setSubmitted(true);
  };

  if (submitted) {
    return (
      <QualifierWrapper
        as={motion.div}
        variants={fadeInUpVariant}
        initial="hidden"
        animate="visible"
      >
        <SuccessNote data-testid="qualifier-success">
          ✓ Thanks! We'll review this before our call.
        </SuccessNote>
      </QualifierWrapper>
    );
  }

  return (
    <QualifierWrapper
      as={motion.div}
      variants={fadeInUpVariant}
      initial="hidden"
      whileInView="visible"
      viewport={{ once: true }}
      data-testid="lead-qualifier"
    >
      <QualifierHeader>
        <h3>Help Us Prepare</h3>
        <OptionalNote>Optional - you can fill this out after booking too</OptionalNote>
      </QualifierHeader>

      <QualifierForm onSubmit={handleSubmit}>
        <FormField label="Budget Range" htmlFor="budget">
          <Select
            id="budget"
            value={budget}
            onChange={(e) => setBudget(e.target.value)}
            options={BUDGET_OPTIONS}
            placeholder="Select a range"
          />
        </FormField>

        <FormField
          label="Project Overview"
          htmlFor="overview"
          helperText="Brief description of what you're looking to build"
        >
          <TextArea
            id="overview"
            value={overview}
            onChange={(e) => setOverview(e.target.value)}
            placeholder="Tell us about your project..."
            rows={4}
          />
        </FormField>

        <Button type="submit" variant="secondary" size="sm">
          Save for Our Call
        </Button>
      </QualifierForm>
    </QualifierWrapper>
  );
};

export default LeadQualifier;
```

---

## What To Expect Component

#### `src/components/UI/ConsultationPage/WhatToExpect.tsx`
```typescript
'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { staggerContainerVariant, staggerItemVariant } from '@/styles';
import { ExpectWrapper, ExpectTitle, ExpectList, ExpectItem, ExpectNote } from './styles';

const EXPECTATIONS = [
  'Discuss your project goals and challenges',
  'Explore potential technical approaches',
  'Provide initial recommendations and insights',
  'Answer any questions you have about working together',
];

const WhatToExpect: React.FC = () => {
  return (
    <ExpectWrapper
      as={motion.div}
      variants={staggerContainerVariant}
      initial="hidden"
      whileInView="visible"
      viewport={{ once: true }}
      data-testid="what-to-expect"
    >
      <ExpectTitle as={motion.h2} variants={staggerItemVariant}>
        What to Expect
      </ExpectTitle>

      <motion.p variants={staggerItemVariant}>
        In this free 30-minute consultation, we'll:
      </motion.p>

      <ExpectList>
        {EXPECTATIONS.map((item, index) => (
          <ExpectItem
            key={index}
            as={motion.li}
            variants={staggerItemVariant}
          >
            <span className="check">✓</span>
            {item}
          </ExpectItem>
        ))}
      </ExpectList>

      <ExpectNote as={motion.p} variants={staggerItemVariant}>
        No commitment required. Just a friendly conversation about your project.
      </ExpectNote>
    </ExpectWrapper>
  );
};

export default WhatToExpect;
```

---

## Page Component

#### `src/app/book-consultation/page.tsx`
```typescript
import { Metadata } from 'next';
import Header from '@/components/Layout/Header';
import Footer from '@/components/Layout/Footer';
import { Section, H1, LeadText } from '@/components/Common';
import CalendlyEmbed from '@/components/Common/CalendlyEmbed';
import WhatToExpect from '@/components/UI/ConsultationPage/WhatToExpect';
import LeadQualifier from '@/components/UI/ConsultationPage/LeadQualifier';

export const metadata: Metadata = {
  title: 'Book a Free Consultation | Xerence Innovations',
  description: 'Schedule a free 30-minute consultation to discuss your project. No commitment required.',
};

const CALENDLY_URL = 'https://calendly.com/xerence/30min';

export default function BookConsultationPage() {
  return (
    <>
      <Header />
      <main>
        <Section padding="xl" centered>
          <H1>Book a Free Consultation</H1>
          <LeadText>
            Let's discuss how we can help bring your vision to life.
          </LeadText>
        </Section>

        <Section padding="md" background="alt">
          <WhatToExpect />
        </Section>

        <Section padding="md">
          <LeadQualifier />
        </Section>

        <Section padding="lg" centered>
          <CalendlyEmbed url={CALENDLY_URL} />
        </Section>
      </main>
      <Footer />
    </>
  );
}
```

---

## Acceptance Criteria

- [ ] Page renders with hero section
- [ ] What to Expect section displays benefits
- [ ] Lead Qualifier form is optional and non-blocking
- [ ] Lead Qualifier saves data locally
- [ ] Calendly embed loads and displays
- [ ] Fallback link to Calendly is present
- [ ] Page is fully responsive
- [ ] Calendly widget is accessible
- [ ] SEO metadata is set
- [ ] All tests pass
- [ ] `npm run lint` passes
- [ ] `npm run build` succeeds

---

## On Completion

1. Update `EXECUTION.md`: Mark T012 as `completed`
2. Commit: `git commit -m "T012: Add book consultation page with Calendly integration"`
