# T004: Navigation System (Header)

## Overview

**Task ID**: T004
**Phase**: 2 - Core Components
**Priority**: High
**Dependencies**: T001, T003
**Estimated Complexity**: Medium

## Objective

Create a complete navigation system including a responsive header with logo, navigation links, mobile hamburger menu, and a prominent "Book a Consultation" CTA button. The header should be sticky, have smooth animations, and work seamlessly on all screen sizes.

---

## Prerequisites

Before starting this task:
1. Read `CLAUDE.md` for agent rules
2. Check `EXECUTION.md` - Ensure T001 and T003 are `completed`
3. Mark this task as `in_progress` in `EXECUTION.md`
4. Read `SHARED_NOTES.md` for any relevant notes

---

## File Ownership

```
CREATE:
- src/components/Layout/Header/index.tsx
- src/components/Layout/Header/styles.ts
- src/components/Layout/Header/Header.test.tsx
- src/components/Layout/Navigation/index.tsx
- src/components/Layout/Navigation/styles.ts
- src/components/Layout/Navigation/Navigation.test.tsx
- src/components/Layout/MobileMenu/index.tsx
- src/components/Layout/MobileMenu/styles.ts
- src/components/Layout/MobileMenu/MobileMenu.test.tsx
- src/components/Layout/Header/constants.ts

DO NOT MODIFY:
- Any files outside the Layout/Header, Layout/Navigation, Layout/MobileMenu directories
```

---

## Detailed Requirements

### Navigation Structure

```
[Logo] Home | Services | Projects | About | Contact | [Book a Consultation - Button]
```

### Navigation Links Data

```typescript
// src/components/Layout/Header/constants.ts
export const NAV_LINKS = [
  { label: 'Home', href: '/' },
  { label: 'Services', href: '/services' },
  { label: 'Projects', href: '/projects' },
  { label: 'About', href: '/about' },
  { label: 'Contact', href: '/contact' },
] as const;

export const CTA_LINK = {
  label: 'Book a Consultation',
  href: '/book-consultation',
} as const;
```

### Component Specifications

#### Header Component
- Sticky positioning at top of page
- Background blur effect when scrolled (glassmorphism)
- Height: 80px desktop, 64px mobile
- Contains: Logo, Navigation, MobileMenu toggle, CTA button
- Smooth show/hide on scroll (optional enhancement)

#### Navigation Component (Desktop)
- Horizontal list of links
- Active state indicator
- Hover animations
- Hidden on mobile (< 768px)

#### MobileMenu Component
- Full-screen overlay menu
- Hamburger icon toggle (animated)
- Slide-in animation
- Links stacked vertically
- Close on link click or outside click
- Body scroll lock when open

### Implementation

#### `src/components/Layout/Header/constants.ts`
```typescript
export const NAV_LINKS = [
  { label: 'Home', href: '/' },
  { label: 'Services', href: '/services' },
  { label: 'Projects', href: '/projects' },
  { label: 'About', href: '/about' },
  { label: 'Contact', href: '/contact' },
] as const;

export const CTA_LINK = {
  label: 'Book a Consultation',
  href: '/book-consultation',
} as const;

export type NavLink = (typeof NAV_LINKS)[number];
```

#### `src/components/Layout/Header/index.tsx`
```typescript
'use client';

import React, { useState, useEffect } from 'react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { motion, AnimatePresence } from 'framer-motion';
import Navigation from '../Navigation';
import MobileMenu from '../MobileMenu';
import { NAV_LINKS, CTA_LINK } from './constants';
import {
  HeaderWrapper,
  HeaderContainer,
  Logo,
  LogoText,
  CTAButton,
  MenuButton,
  MenuIcon,
} from './styles';

const Header: React.FC = () => {
  const [isScrolled, setIsScrolled] = useState(false);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const pathname = usePathname();

  useEffect(() => {
    const handleScroll = () => {
      setIsScrolled(window.scrollY > 20);
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  // Close mobile menu on route change
  useEffect(() => {
    setIsMobileMenuOpen(false);
  }, [pathname]);

  // Lock body scroll when mobile menu is open
  useEffect(() => {
    if (isMobileMenuOpen) {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = '';
    }
    return () => {
      document.body.style.overflow = '';
    };
  }, [isMobileMenuOpen]);

  const toggleMobileMenu = () => {
    setIsMobileMenuOpen((prev) => !prev);
  };

  return (
    <>
      <HeaderWrapper
        $isScrolled={isScrolled}
        data-testid="header"
        as={motion.header}
        initial={{ y: -100 }}
        animate={{ y: 0 }}
        transition={{ duration: 0.5, ease: 'easeOut' }}
      >
        <HeaderContainer>
          <Logo href="/" aria-label="Xerence Home">
            <LogoText>Xerence</LogoText>
          </Logo>

          <Navigation links={NAV_LINKS} currentPath={pathname} />

          <CTAButton
            href={CTA_LINK.href}
            as={Link}
            data-testid="header-cta"
          >
            {CTA_LINK.label}
          </CTAButton>

          <MenuButton
            onClick={toggleMobileMenu}
            aria-label={isMobileMenuOpen ? 'Close menu' : 'Open menu'}
            aria-expanded={isMobileMenuOpen}
            data-testid="mobile-menu-button"
          >
            <MenuIcon $isOpen={isMobileMenuOpen}>
              <span />
              <span />
              <span />
            </MenuIcon>
          </MenuButton>
        </HeaderContainer>
      </HeaderWrapper>

      <AnimatePresence>
        {isMobileMenuOpen && (
          <MobileMenu
            links={NAV_LINKS}
            ctaLink={CTA_LINK}
            currentPath={pathname}
            onClose={() => setIsMobileMenuOpen(false)}
          />
        )}
      </AnimatePresence>
    </>
  );
};

export default Header;
```

#### `src/components/Layout/Header/styles.ts`
```typescript
import styled, { css } from 'styled-components';
import Link from 'next/link';
import { glassMorphism, flexBetween, containerStyles } from '@/styles';

interface HeaderWrapperProps {
  $isScrolled: boolean;
}

export const HeaderWrapper = styled.header<HeaderWrapperProps>`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: ${({ theme }) => theme.zIndex.fixed};
  height: 64px;
  transition: all ${({ theme }) => theme.transitions.normal};

  ${({ $isScrolled }) =>
    $isScrolled &&
    css`
      ${glassMorphism}
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
    `}

  @media (min-width: ${({ theme }) => theme.breakpoints.md}) {
    height: 80px;
  }
`;

export const HeaderContainer = styled.div`
  ${containerStyles}
  ${flexBetween}
  height: 100%;
  gap: ${({ theme }) => theme.spacing[4]};
`;

export const Logo = styled(Link)`
  display: flex;
  align-items: center;
  text-decoration: none;
  z-index: 10;
`;

export const LogoText = styled.span`
  font-size: ${({ theme }) => theme.fontSizes.xl};
  font-weight: ${({ theme }) => theme.fontWeights.bold};
  color: ${({ theme }) => theme.colors.white};
  letter-spacing: -0.02em;

  @media (min-width: ${({ theme }) => theme.breakpoints.md}) {
    font-size: ${({ theme }) => theme.fontSizes['2xl']};
  }
`;

export const CTAButton = styled.a`
  display: none;
  padding: ${({ theme }) => `${theme.spacing[3]} ${theme.spacing[6]}`};
  background-color: ${({ theme }) => theme.colors.primary};
  color: ${({ theme }) => theme.colors.background};
  font-size: ${({ theme }) => theme.fontSizes.sm};
  font-weight: ${({ theme }) => theme.fontWeights.semibold};
  border-radius: ${({ theme }) => theme.borderRadius.full};
  text-decoration: none;
  transition: all ${({ theme }) => theme.transitions.fast};

  &:hover {
    background-color: ${({ theme }) => theme.colors.primaryHover};
    transform: translateY(-2px);
    box-shadow: ${({ theme }) => theme.shadows.glow};
  }

  &:active {
    transform: translateY(0);
  }

  @media (min-width: ${({ theme }) => theme.breakpoints.md}) {
    display: inline-flex;
  }
`;

export const MenuButton = styled.button`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px;
  height: 44px;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 10;

  @media (min-width: ${({ theme }) => theme.breakpoints.md}) {
    display: none;
  }
`;

interface MenuIconProps {
  $isOpen: boolean;
}

export const MenuIcon = styled.div<MenuIconProps>`
  width: 24px;
  height: 20px;
  position: relative;

  span {
    position: absolute;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: ${({ theme }) => theme.colors.white};
    border-radius: 2px;
    transition: all ${({ theme }) => theme.transitions.fast};

    &:nth-child(1) {
      top: 0;
      ${({ $isOpen }) =>
        $isOpen &&
        css`
          top: 9px;
          transform: rotate(45deg);
        `}
    }

    &:nth-child(2) {
      top: 9px;
      ${({ $isOpen }) =>
        $isOpen &&
        css`
          opacity: 0;
        `}
    }

    &:nth-child(3) {
      top: 18px;
      ${({ $isOpen }) =>
        $isOpen &&
        css`
          top: 9px;
          transform: rotate(-45deg);
        `}
    }
  }
`;
```

#### `src/components/Layout/Navigation/index.tsx`
```typescript
'use client';

import React from 'react';
import Link from 'next/link';
import type { NavLink } from '../Header/constants';
import { Nav, NavList, NavItem, NavLink as StyledNavLink } from './styles';

interface NavigationProps {
  links: readonly NavLink[];
  currentPath: string;
}

const Navigation: React.FC<NavigationProps> = ({ links, currentPath }) => {
  const isActive = (href: string) => {
    if (href === '/') {
      return currentPath === '/';
    }
    return currentPath.startsWith(href);
  };

  return (
    <Nav data-testid="desktop-navigation">
      <NavList>
        {links.map((link) => (
          <NavItem key={link.href}>
            <StyledNavLink
              href={link.href}
              as={Link}
              $isActive={isActive(link.href)}
              aria-current={isActive(link.href) ? 'page' : undefined}
            >
              {link.label}
            </StyledNavLink>
          </NavItem>
        ))}
      </NavList>
    </Nav>
  );
};

export default Navigation;
```

#### `src/components/Layout/Navigation/styles.ts`
```typescript
import styled, { css } from 'styled-components';

export const Nav = styled.nav`
  display: none;

  @media (min-width: ${({ theme }) => theme.breakpoints.md}) {
    display: block;
  }
`;

export const NavList = styled.ul`
  display: flex;
  align-items: center;
  gap: ${({ theme }) => theme.spacing[8]};
  list-style: none;
  margin: 0;
  padding: 0;
`;

export const NavItem = styled.li``;

interface NavLinkProps {
  $isActive: boolean;
}

export const NavLink = styled.a<NavLinkProps>`
  position: relative;
  font-size: ${({ theme }) => theme.fontSizes.sm};
  font-weight: ${({ theme }) => theme.fontWeights.medium};
  color: ${({ theme, $isActive }) =>
    $isActive ? theme.colors.white : theme.colors.linkColor};
  text-decoration: none;
  transition: color ${({ theme }) => theme.transitions.fast};
  padding: ${({ theme }) => theme.spacing[2]} 0;

  &::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: ${({ theme }) => theme.colors.primary};
    transform: scaleX(0);
    transform-origin: right;
    transition: transform ${({ theme }) => theme.transitions.fast};

    ${({ $isActive }) =>
      $isActive &&
      css`
        transform: scaleX(1);
        transform-origin: left;
      `}
  }

  &:hover {
    color: ${({ theme }) => theme.colors.white};

    &::after {
      transform: scaleX(1);
      transform-origin: left;
    }
  }
`;
```

#### `src/components/Layout/MobileMenu/index.tsx`
```typescript
'use client';

import React from 'react';
import Link from 'next/link';
import { motion } from 'framer-motion';
import type { NavLink } from '../Header/constants';
import {
  MenuOverlay,
  MenuContent,
  MenuList,
  MenuItem,
  MenuLink,
  MenuCTA,
} from './styles';

interface MobileMenuProps {
  links: readonly NavLink[];
  ctaLink: { label: string; href: string };
  currentPath: string;
  onClose: () => void;
}

const overlayVariants = {
  hidden: { opacity: 0 },
  visible: { opacity: 1 },
  exit: { opacity: 0 },
};

const menuVariants = {
  hidden: { x: '100%' },
  visible: {
    x: 0,
    transition: {
      type: 'tween',
      duration: 0.3,
      ease: 'easeOut',
      when: 'beforeChildren',
      staggerChildren: 0.05,
    },
  },
  exit: {
    x: '100%',
    transition: { duration: 0.2 },
  },
};

const itemVariants = {
  hidden: { opacity: 0, x: 20 },
  visible: { opacity: 1, x: 0 },
};

const MobileMenu: React.FC<MobileMenuProps> = ({
  links,
  ctaLink,
  currentPath,
  onClose,
}) => {
  const isActive = (href: string) => {
    if (href === '/') {
      return currentPath === '/';
    }
    return currentPath.startsWith(href);
  };

  return (
    <MenuOverlay
      as={motion.div}
      variants={overlayVariants}
      initial="hidden"
      animate="visible"
      exit="exit"
      onClick={onClose}
      data-testid="mobile-menu"
    >
      <MenuContent
        as={motion.div}
        variants={menuVariants}
        onClick={(e) => e.stopPropagation()}
      >
        <MenuList>
          {links.map((link) => (
            <MenuItem
              key={link.href}
              as={motion.li}
              variants={itemVariants}
            >
              <MenuLink
                href={link.href}
                as={Link}
                $isActive={isActive(link.href)}
                onClick={onClose}
              >
                {link.label}
              </MenuLink>
            </MenuItem>
          ))}
          <MenuItem as={motion.li} variants={itemVariants}>
            <MenuCTA href={ctaLink.href} as={Link} onClick={onClose}>
              {ctaLink.label}
            </MenuCTA>
          </MenuItem>
        </MenuList>
      </MenuContent>
    </MenuOverlay>
  );
};

export default MobileMenu;
```

#### `src/components/Layout/MobileMenu/styles.ts`
```typescript
import styled, { css } from 'styled-components';
import { flexColumnCenter } from '@/styles';

export const MenuOverlay = styled.div`
  position: fixed;
  inset: 0;
  z-index: ${({ theme }) => theme.zIndex.modalBackdrop};
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
`;

export const MenuContent = styled.div`
  position: absolute;
  top: 0;
  right: 0;
  width: 80%;
  max-width: 320px;
  height: 100%;
  background-color: ${({ theme }) => theme.colors.background};
  padding: ${({ theme }) => theme.spacing[24]} ${({ theme }) => theme.spacing[8]};
  ${flexColumnCenter}
`;

export const MenuList = styled.ul`
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: ${({ theme }) => theme.spacing[6]};
  list-style: none;
  margin: 0;
  padding: 0;
  width: 100%;
`;

export const MenuItem = styled.li`
  width: 100%;
  text-align: center;
`;

interface MenuLinkProps {
  $isActive: boolean;
}

export const MenuLink = styled.a<MenuLinkProps>`
  display: block;
  font-size: ${({ theme }) => theme.fontSizes.xl};
  font-weight: ${({ theme }) => theme.fontWeights.medium};
  color: ${({ theme, $isActive }) =>
    $isActive ? theme.colors.primary : theme.colors.white};
  text-decoration: none;
  padding: ${({ theme }) => theme.spacing[3]} 0;
  transition: color ${({ theme }) => theme.transitions.fast};

  &:hover {
    color: ${({ theme }) => theme.colors.primary};
  }
`;

export const MenuCTA = styled.a`
  display: inline-block;
  margin-top: ${({ theme }) => theme.spacing[4]};
  padding: ${({ theme }) => `${theme.spacing[4]} ${theme.spacing[8]}`};
  background-color: ${({ theme }) => theme.colors.primary};
  color: ${({ theme }) => theme.colors.background};
  font-size: ${({ theme }) => theme.fontSizes.md};
  font-weight: ${({ theme }) => theme.fontWeights.semibold};
  border-radius: ${({ theme }) => theme.borderRadius.full};
  text-decoration: none;
  transition: all ${({ theme }) => theme.transitions.fast};

  &:hover {
    background-color: ${({ theme }) => theme.colors.primaryHover};
  }
`;
```

### Tests

#### `src/components/Layout/Header/Header.test.tsx`
```typescript
import React from 'react';
import { render, screen, fireEvent } from '@/__tests__/test-utils';
import Header from './index';
import { NAV_LINKS, CTA_LINK } from './constants';

// Mock next/navigation
jest.mock('next/navigation', () => ({
  usePathname: () => '/',
}));

describe('Header', () => {
  it('should render the header', () => {
    render(<Header />);
    expect(screen.getByTestId('header')).toBeInTheDocument();
  });

  it('should render the logo', () => {
    render(<Header />);
    expect(screen.getByText('Xerence')).toBeInTheDocument();
  });

  it('should render the CTA button', () => {
    render(<Header />);
    expect(screen.getByTestId('header-cta')).toBeInTheDocument();
    expect(screen.getByText(CTA_LINK.label)).toBeInTheDocument();
  });

  it('should render mobile menu button', () => {
    render(<Header />);
    expect(screen.getByTestId('mobile-menu-button')).toBeInTheDocument();
  });

  it('should toggle mobile menu on button click', () => {
    render(<Header />);
    const menuButton = screen.getByTestId('mobile-menu-button');

    // Menu should not be visible initially
    expect(screen.queryByTestId('mobile-menu')).not.toBeInTheDocument();

    // Click to open
    fireEvent.click(menuButton);
    expect(screen.getByTestId('mobile-menu')).toBeInTheDocument();

    // Click to close
    fireEvent.click(menuButton);
    // AnimatePresence may delay unmount, so we check for aria-expanded
    expect(menuButton).toHaveAttribute('aria-expanded', 'false');
  });

  it('should have accessible menu button', () => {
    render(<Header />);
    const menuButton = screen.getByTestId('mobile-menu-button');
    expect(menuButton).toHaveAttribute('aria-label');
    expect(menuButton).toHaveAttribute('aria-expanded', 'false');
  });
});
```

#### `src/components/Layout/Navigation/Navigation.test.tsx`
```typescript
import React from 'react';
import { render, screen } from '@/__tests__/test-utils';
import Navigation from './index';
import { NAV_LINKS } from '../Header/constants';

describe('Navigation', () => {
  const defaultProps = {
    links: NAV_LINKS,
    currentPath: '/',
  };

  it('should render navigation', () => {
    render(<Navigation {...defaultProps} />);
    expect(screen.getByTestId('desktop-navigation')).toBeInTheDocument();
  });

  it('should render all navigation links', () => {
    render(<Navigation {...defaultProps} />);
    NAV_LINKS.forEach((link) => {
      expect(screen.getByText(link.label)).toBeInTheDocument();
    });
  });

  it('should mark active link with aria-current', () => {
    render(<Navigation {...defaultProps} currentPath="/" />);
    const homeLink = screen.getByText('Home');
    expect(homeLink).toHaveAttribute('aria-current', 'page');
  });

  it('should not mark inactive links with aria-current', () => {
    render(<Navigation {...defaultProps} currentPath="/" />);
    const servicesLink = screen.getByText('Services');
    expect(servicesLink).not.toHaveAttribute('aria-current');
  });

  it('should handle nested paths correctly', () => {
    render(<Navigation {...defaultProps} currentPath="/projects/some-project" />);
    const projectsLink = screen.getByText('Projects');
    expect(projectsLink).toHaveAttribute('aria-current', 'page');
  });
});
```

#### `src/components/Layout/MobileMenu/MobileMenu.test.tsx`
```typescript
import React from 'react';
import { render, screen, fireEvent } from '@/__tests__/test-utils';
import MobileMenu from './index';
import { NAV_LINKS, CTA_LINK } from '../Header/constants';

describe('MobileMenu', () => {
  const defaultProps = {
    links: NAV_LINKS,
    ctaLink: CTA_LINK,
    currentPath: '/',
    onClose: jest.fn(),
  };

  beforeEach(() => {
    jest.clearAllMocks();
  });

  it('should render mobile menu', () => {
    render(<MobileMenu {...defaultProps} />);
    expect(screen.getByTestId('mobile-menu')).toBeInTheDocument();
  });

  it('should render all navigation links', () => {
    render(<MobileMenu {...defaultProps} />);
    NAV_LINKS.forEach((link) => {
      expect(screen.getByText(link.label)).toBeInTheDocument();
    });
  });

  it('should render CTA button', () => {
    render(<MobileMenu {...defaultProps} />);
    expect(screen.getByText(CTA_LINK.label)).toBeInTheDocument();
  });

  it('should call onClose when overlay is clicked', () => {
    render(<MobileMenu {...defaultProps} />);
    const overlay = screen.getByTestId('mobile-menu');
    fireEvent.click(overlay);
    expect(defaultProps.onClose).toHaveBeenCalledTimes(1);
  });

  it('should call onClose when a link is clicked', () => {
    render(<MobileMenu {...defaultProps} />);
    const homeLink = screen.getByText('Home');
    fireEvent.click(homeLink);
    expect(defaultProps.onClose).toHaveBeenCalledTimes(1);
  });
});
```

---

## Acceptance Criteria

- [ ] Header renders correctly on all screen sizes
- [ ] Logo links to home page
- [ ] Navigation links display on desktop (â‰¥768px)
- [ ] Mobile menu button displays on mobile (<768px)
- [ ] Mobile menu opens/closes correctly
- [ ] Active link is highlighted
- [ ] CTA button is prominent and functional
- [ ] Hamburger icon animates to X when menu is open
- [ ] Body scroll is locked when mobile menu is open
- [ ] Header has glassmorphism effect when scrolled
- [ ] All tests pass
- [ ] No accessibility issues (proper ARIA attributes)
- [ ] `npm run lint` passes
- [ ] `npm run build` succeeds

---

## Verification Commands

```bash
npm run test -- --testPathPattern="Header|Navigation|MobileMenu"
npm run lint
npm run build
```

---

## On Completion

1. Update `EXECUTION.md`:
   - Mark T004 as `completed`
   - Check if T008-T012 can be unblocked

2. Update `SHARED_NOTES.md`:
   - Document navigation patterns
   - Note any reusable patterns for other components

3. Commit changes:
   ```bash
   git add .
   git commit -m "T004: Add responsive navigation system with header and mobile menu"
   ```
