# T014: Project Detail Page

## Overview

**Task ID**: T014
**Phase**: 3 - Pages
**Priority**: High
**Dependencies**: T002, T004, T005, T006
**Estimated Complexity**: Medium

## Objective

Create dynamic project detail pages that showcase individual projects with problem/solution narrative, outcomes, tech stack, gallery images, and CTAs for booking consultations.

---

## Prerequisites

Before starting this task:
1. Read `CLAUDE.md` for agent rules
2. Check `EXECUTION.md` - Ensure T002, T004, T005, T006 are `completed`
3. Mark this task as `in_progress` in `EXECUTION.md`
4. Read `SHARED_NOTES.md` for any relevant notes

---

## File Ownership

```
CREATE:
- src/app/projects/[slug]/page.tsx
- src/components/UI/ProjectDetail/ProjectHero.tsx
- src/components/UI/ProjectDetail/ProjectContent.tsx
- src/components/UI/ProjectDetail/ProjectGallery.tsx
- src/components/UI/ProjectDetail/ProjectSidebar.tsx
- src/components/UI/ProjectDetail/styles.ts
- src/components/UI/ProjectDetail/ProjectDetail.test.tsx
```

---

## Page Structure

```
┌─────────────────────────────────────────────────────────────────┐
│ [Header]                                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  PROJECT HERO                                                    │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                                                              ││
│  │              [Featured Image - Full Width]                   ││
│  │                                                              ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
│  Project Title                                                   │
│  Short Description                                               │
│  [Tech Tag] [Tech Tag] [Tech Tag]                               │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────┐ ┌────────────────────────────┐ │
│  │                             │ │     SIDEBAR               │ │
│  │  THE CHALLENGE              │ │                           │ │
│  │  (Problem description)      │ │  Client: Name             │ │
│  │                             │ │  [Client Logo]            │ │
│  │  ──────────────────────     │ │                           │ │
│  │                             │ │  Tech Stack:              │ │
│  │  THE SOLUTION               │ │  • React                  │ │
│  │  (Solution description)     │ │  • Node.js                │ │
│  │                             │ │  • PostgreSQL             │ │
│  │  ──────────────────────     │ │                           │ │
│  │                             │ │  ─────────────────────    │ │
│  │  OUTCOMES                   │ │                           │ │
│  │  ✓ Outcome 1               │ │  [Visit Project →]        │ │
│  │  ✓ Outcome 2               │ │                           │ │
│  │  ✓ Outcome 3               │ │                           │ │
│  │                             │ └────────────────────────────┘ │
│  └─────────────────────────────┘                                │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  PROJECT GALLERY                                                 │
│  [Image 1] [Image 2] [Image 3] [Image 4]                        │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                   CTA SECTION                                    │
│     "Want to build something similar? Let's talk."              │
│              [Book a Free Consultation]                          │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│ [Footer]                                                        │
└─────────────────────────────────────────────────────────────────┘
```

---

## Dynamic Route Implementation

### Page Component

#### `src/app/projects/[slug]/page.tsx`
```typescript
import { Metadata } from 'next';
import { notFound } from 'next/navigation';
import Header from '@/components/Layout/Header';
import Footer from '@/components/Layout/Footer';
import { Section } from '@/components/Common';
import { ProjectHero } from '@/components/UI/ProjectDetail/ProjectHero';
import { ProjectContent } from '@/components/UI/ProjectDetail/ProjectContent';
import { ProjectGallery } from '@/components/UI/ProjectDetail/ProjectGallery';
import { CTASection } from '@/components/UI/CTASection';
import { getProjectBySlug, getProjectSlugs } from '@/sanity/lib/fetch';
import { urlForImage } from '@/sanity/lib/image';

interface ProjectPageProps {
  params: { slug: string };
}

// Generate static paths for all projects
export async function generateStaticParams() {
  const slugs = await getProjectSlugs();
  return slugs.map((slug) => ({ slug }));
}

// Generate metadata for each project
export async function generateMetadata({ params }: ProjectPageProps): Promise<Metadata> {
  const project = await getProjectBySlug(params.slug);

  if (!project) {
    return {
      title: 'Project Not Found | Xerence Innovations',
    };
  }

  const imageUrl = project.featuredImage
    ? urlForImage(project.featuredImage)?.width(1200).height(630).url()
    : undefined;

  return {
    title: `${project.title} | Projects | Xerence Innovations`,
    description: project.description,
    openGraph: {
      title: project.title,
      description: project.description,
      images: imageUrl ? [imageUrl] : [],
    },
  };
}

// Revalidate every hour
export const revalidate = 3600;

export default async function ProjectPage({ params }: ProjectPageProps) {
  const project = await getProjectBySlug(params.slug);

  if (!project) {
    notFound();
  }

  return (
    <>
      <Header />
      <main>
        <ProjectHero project={project} />

        <Section padding="lg">
          <ProjectContent project={project} />
        </Section>

        {project.gallery && project.gallery.length > 0 && (
          <Section padding="md" background="alt">
            <ProjectGallery images={project.gallery} projectTitle={project.title} />
          </Section>
        )}

        <CTASection
          title="Want to build something similar?"
          subtitle="Let's discuss how we can create something amazing for you."
          ctaText="Book a Free Consultation"
          ctaHref="/book-consultation"
        />
      </main>
      <Footer />
    </>
  );
}
```

### Project Hero Component

#### `src/components/UI/ProjectDetail/ProjectHero.tsx`
```typescript
'use client';

import React from 'react';
import Image from 'next/image';
import { motion } from 'framer-motion';
import { Tag } from '@/components/Common';
import { urlForImage } from '@/sanity/lib/image';
import { fadeInUpVariant } from '@/styles';
import type { Project } from '@/types/sanity';
import {
  HeroWrapper,
  HeroImageWrapper,
  HeroContent,
  HeroTitle,
  HeroDescription,
  HeroTags,
} from './styles';

interface ProjectHeroProps {
  project: Project;
}

export const ProjectHero: React.FC<ProjectHeroProps> = ({ project }) => {
  const imageUrl = project.featuredImage
    ? urlForImage(project.featuredImage)?.width(1920).height(800).url()
    : null;

  return (
    <HeroWrapper data-testid="project-hero">
      {imageUrl && (
        <HeroImageWrapper>
          <Image
            src={imageUrl}
            alt={project.featuredImage?.alt || project.title}
            fill
            priority
            sizes="100vw"
            style={{ objectFit: 'cover' }}
          />
          <div className="overlay" />
        </HeroImageWrapper>
      )}

      <HeroContent
        as={motion.div}
        variants={fadeInUpVariant}
        initial="hidden"
        animate="visible"
      >
        <HeroTitle>{project.title}</HeroTitle>
        <HeroDescription>{project.description}</HeroDescription>

        {project.techStack && project.techStack.length > 0 && (
          <HeroTags>
            {project.techStack.map((tech) => (
              <Tag key={tech}>{tech}</Tag>
            ))}
          </HeroTags>
        )}
      </HeroContent>
    </HeroWrapper>
  );
};
```

### Project Content Component

#### `src/components/UI/ProjectDetail/ProjectContent.tsx`
```typescript
'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { PortableText } from '@portabletext/react';
import { Button, Tag } from '@/components/Common';
import { urlForImage } from '@/sanity/lib/image';
import { staggerContainerVariant, staggerItemVariant } from '@/styles';
import type { Project } from '@/types/sanity';
import {
  ContentWrapper,
  MainContent,
  ContentSection,
  SectionTitle,
  OutcomesList,
  OutcomeItem,
  Sidebar,
  SidebarSection,
  SidebarTitle,
  ClientInfo,
  ClientLogo,
  TechList,
} from './styles';

interface ProjectContentProps {
  project: Project;
}

export const ProjectContent: React.FC<ProjectContentProps> = ({ project }) => {
  const clientLogoUrl = project.clientLogo
    ? urlForImage(project.clientLogo)?.width(200).url()
    : null;

  return (
    <ContentWrapper
      as={motion.div}
      variants={staggerContainerVariant}
      initial="hidden"
      whileInView="visible"
      viewport={{ once: true }}
      data-testid="project-content"
    >
      <MainContent>
        {project.problem && (
          <ContentSection as={motion.div} variants={staggerItemVariant}>
            <SectionTitle>The Challenge</SectionTitle>
            <PortableText value={project.problem} />
          </ContentSection>
        )}

        {project.solution && (
          <ContentSection as={motion.div} variants={staggerItemVariant}>
            <SectionTitle>The Solution</SectionTitle>
            <PortableText value={project.solution} />
          </ContentSection>
        )}

        {project.outcomes && project.outcomes.length > 0 && (
          <ContentSection as={motion.div} variants={staggerItemVariant}>
            <SectionTitle>Outcomes</SectionTitle>
            <OutcomesList>
              {project.outcomes.map((outcome, index) => (
                <OutcomeItem key={index}>
                  <span className="check">✓</span>
                  {outcome}
                </OutcomeItem>
              ))}
            </OutcomesList>
          </ContentSection>
        )}
      </MainContent>

      <Sidebar as={motion.aside} variants={staggerItemVariant}>
        {project.clientName && (
          <SidebarSection>
            <SidebarTitle>Client</SidebarTitle>
            <ClientInfo>
              {clientLogoUrl && (
                <ClientLogo>
                  <img src={clientLogoUrl} alt={`${project.clientName} logo`} />
                </ClientLogo>
              )}
              <span>{project.clientName}</span>
            </ClientInfo>
          </SidebarSection>
        )}

        {project.techStack && project.techStack.length > 0 && (
          <SidebarSection>
            <SidebarTitle>Tech Stack</SidebarTitle>
            <TechList>
              {project.techStack.map((tech) => (
                <li key={tech}>{tech}</li>
              ))}
            </TechList>
          </SidebarSection>
        )}

        {project.projectUrl && (
          <SidebarSection>
            <Button
              href={project.projectUrl}
              variant="outline"
              size="sm"
              rightIcon={<span>→</span>}
            >
              Visit Project
            </Button>
          </SidebarSection>
        )}
      </Sidebar>
    </ContentWrapper>
  );
};
```

### Project Gallery Component

#### `src/components/UI/ProjectDetail/ProjectGallery.tsx`
```typescript
'use client';

import React, { useState } from 'react';
import Image from 'next/image';
import { motion, AnimatePresence } from 'framer-motion';
import { urlForImage } from '@/sanity/lib/image';
import type { SanityImage } from '@/types/sanity';
import {
  GalleryWrapper,
  GalleryTitle,
  GalleryGrid,
  GalleryItem,
  Lightbox,
  LightboxContent,
  LightboxClose,
} from './styles';

interface ProjectGalleryProps {
  images: SanityImage[];
  projectTitle: string;
}

export const ProjectGallery: React.FC<ProjectGalleryProps> = ({
  images,
  projectTitle,
}) => {
  const [selectedImage, setSelectedImage] = useState<number | null>(null);

  return (
    <GalleryWrapper data-testid="project-gallery">
      <GalleryTitle>Project Gallery</GalleryTitle>

      <GalleryGrid>
        {images.map((image, index) => {
          const imageUrl = urlForImage(image)?.width(600).height(400).url();
          if (!imageUrl) return null;

          return (
            <GalleryItem
              key={index}
              as={motion.button}
              whileHover={{ scale: 1.02 }}
              onClick={() => setSelectedImage(index)}
            >
              <Image
                src={imageUrl}
                alt={image.alt || `${projectTitle} screenshot ${index + 1}`}
                fill
                sizes="(max-width: 768px) 50vw, 25vw"
                style={{ objectFit: 'cover' }}
              />
            </GalleryItem>
          );
        })}
      </GalleryGrid>

      <AnimatePresence>
        {selectedImage !== null && (
          <Lightbox
            as={motion.div}
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={() => setSelectedImage(null)}
          >
            <LightboxContent onClick={(e) => e.stopPropagation()}>
              <Image
                src={urlForImage(images[selectedImage])?.width(1200).url() || ''}
                alt={images[selectedImage].alt || `${projectTitle} screenshot`}
                width={1200}
                height={800}
                style={{ objectFit: 'contain', maxHeight: '80vh', width: 'auto' }}
              />
            </LightboxContent>
            <LightboxClose onClick={() => setSelectedImage(null)}>×</LightboxClose>
          </Lightbox>
        )}
      </AnimatePresence>
    </GalleryWrapper>
  );
};
```

---

## Not Found Page

Create a not-found page for invalid slugs:

#### `src/app/projects/[slug]/not-found.tsx`
```typescript
import Link from 'next/link';
import Header from '@/components/Layout/Header';
import Footer from '@/components/Layout/Footer';
import { Section, H1, Button } from '@/components/Common';

export default function ProjectNotFound() {
  return (
    <>
      <Header />
      <main>
        <Section padding="xl" centered>
          <H1>Project Not Found</H1>
          <p>The project you're looking for doesn't exist or has been removed.</p>
          <Button href="/projects">View All Projects</Button>
        </Section>
      </main>
      <Footer />
    </>
  );
}
```

---

## Acceptance Criteria

- [ ] Page fetches project data by slug from Sanity
- [ ] Hero displays featured image and project info
- [ ] Problem/Solution/Outcomes sections render correctly
- [ ] Sidebar shows client info and tech stack
- [ ] Gallery displays images with lightbox
- [ ] Project URL link works (when available)
- [ ] 404 page shows for invalid slugs
- [ ] Static paths generated for all projects
- [ ] SEO metadata is dynamic
- [ ] Page is fully responsive
- [ ] All tests pass
- [ ] `npm run lint` passes
- [ ] `npm run build` succeeds

---

## On Completion

1. Update `EXECUTION.md`: Mark T014 as `completed`
2. Commit: `git commit -m "T014: Add dynamic project detail pages with gallery"`
