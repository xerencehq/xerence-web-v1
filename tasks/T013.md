# T013: Projects Listing Page

## Overview

**Task ID**: T013
**Phase**: 3 - Pages
**Priority**: High
**Dependencies**: T002, T004, T005, T006
**Estimated Complexity**: Medium

## Objective

Create a Projects listing page that displays all projects from Sanity CMS with search and filtering capabilities. Projects should be displayed in a visually appealing grid with key information visible.

---

## Prerequisites

Before starting this task:
1. Read `CLAUDE.md` for agent rules
2. Check `EXECUTION.md` - Ensure T002, T004, T005, T006 are `completed`
3. Mark this task as `in_progress` in `EXECUTION.md`
4. Read `SHARED_NOTES.md` for any relevant notes

---

## File Ownership

```
CREATE:
- src/app/projects/page.tsx
- src/components/UI/ProjectsPage/ProjectsGrid.tsx
- src/components/UI/ProjectsPage/ProjectCard.tsx
- src/components/UI/ProjectsPage/ProjectFilters.tsx
- src/components/UI/ProjectsPage/styles.ts
- src/components/UI/ProjectsPage/ProjectsPage.test.tsx
```

---

## Page Structure

```
┌─────────────────────────────────────────────────────────────────┐
│ [Header]                                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                     PAGE HERO                                    │
│                   "Our Projects"                                 │
│       "Explore our portfolio of successful projects"            │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  FILTERS & SEARCH                                                │
│  [Search...........................] [Filter by Tech ▼]         │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  PROJECTS GRID                                                   │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                │
│  │  [Image]    │ │  [Image]    │ │  [Image]    │                │
│  │  Project 1  │ │  Project 2  │ │  Project 3  │                │
│  │  Desc...    │ │  Desc...    │ │  Desc...    │                │
│  │  [Tags]     │ │  [Tags]     │ │  [Tags]     │                │
│  └─────────────┘ └─────────────┘ └─────────────┘                │
│                                                                  │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                │
│  │  ...        │ │  ...        │ │  ...        │                │
│  └─────────────┘ └─────────────┘ └─────────────┘                │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                   CTA SECTION                                    │
│        "Have a project in mind? Let's talk."                     │
│              [Book a Free Consultation]                          │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│ [Footer]                                                        │
└─────────────────────────────────────────────────────────────────┘
```

---

## Data Fetching

Uses Sanity queries from T002:

```typescript
import { getAllProjects } from '@/sanity/lib/fetch';
import { urlForImage } from '@/sanity/lib/image';
```

---

## Component Implementation

### Page Component (Server Component)

#### `src/app/projects/page.tsx`
```typescript
import { Metadata } from 'next';
import Header from '@/components/Layout/Header';
import Footer from '@/components/Layout/Footer';
import { Section, H1, LeadText } from '@/components/Common';
import { ProjectsGrid } from '@/components/UI/ProjectsPage/ProjectsGrid';
import { CTASection } from '@/components/UI/CTASection';
import { getAllProjects } from '@/sanity/lib/fetch';

export const metadata: Metadata = {
  title: 'Projects | Xerence Innovations',
  description: 'Explore our portfolio of successful software projects. From AI-powered platforms to mobile apps and enterprise solutions.',
};

// Revalidate every hour
export const revalidate = 3600;

export default async function ProjectsPage() {
  const projects = await getAllProjects();

  return (
    <>
      <Header />
      <main>
        <Section padding="xl" centered>
          <H1>Our Projects</H1>
          <LeadText>
            Explore our portfolio of successful projects across industries.
          </LeadText>
        </Section>

        <Section padding="lg">
          <ProjectsGrid projects={projects} />
        </Section>

        <CTASection
          title="Have a project in mind?"
          subtitle="Let's discuss how we can help bring your idea to life."
          ctaText="Book a Free Consultation"
          ctaHref="/book-consultation"
        />
      </main>
      <Footer />
    </>
  );
}
```

### Projects Grid (Client Component for Interactivity)

#### `src/components/UI/ProjectsPage/ProjectsGrid.tsx`
```typescript
'use client';

import React, { useState, useMemo } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Input } from '@/components/Forms';
import { Tag } from '@/components/Common';
import ProjectCard from './ProjectCard';
import { staggerContainerVariant, staggerItemVariant } from '@/styles';
import type { ProjectListItem } from '@/types/sanity';
import {
  GridWrapper,
  FiltersWrapper,
  SearchWrapper,
  TagFilters,
  ProjectsGridContainer,
  EmptyState,
} from './styles';

interface ProjectsGridProps {
  projects: ProjectListItem[];
}

export const ProjectsGrid: React.FC<ProjectsGridProps> = ({ projects }) => {
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedTech, setSelectedTech] = useState<string | null>(null);

  // Extract all unique tech tags
  const allTechTags = useMemo(() => {
    const tags = new Set<string>();
    projects.forEach((project) => {
      project.techStack?.forEach((tech) => tags.add(tech));
    });
    return Array.from(tags).sort();
  }, [projects]);

  // Filter projects based on search and tech filter
  const filteredProjects = useMemo(() => {
    return projects.filter((project) => {
      const matchesSearch =
        !searchQuery ||
        project.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
        project.description.toLowerCase().includes(searchQuery.toLowerCase());

      const matchesTech =
        !selectedTech || project.techStack?.includes(selectedTech);

      return matchesSearch && matchesTech;
    });
  }, [projects, searchQuery, selectedTech]);

  const handleTechFilter = (tech: string) => {
    setSelectedTech(selectedTech === tech ? null : tech);
  };

  return (
    <GridWrapper data-testid="projects-grid">
      <FiltersWrapper>
        <SearchWrapper>
          <Input
            placeholder="Search projects..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            icon={
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8" />
                <path d="M21 21l-4.35-4.35" />
              </svg>
            }
          />
        </SearchWrapper>

        {allTechTags.length > 0 && (
          <TagFilters>
            {allTechTags.slice(0, 10).map((tech) => (
              <Tag
                key={tech}
                variant={selectedTech === tech ? 'default' : 'outline'}
                onClick={() => handleTechFilter(tech)}
              >
                {tech}
              </Tag>
            ))}
          </TagFilters>
        )}
      </FiltersWrapper>

      <AnimatePresence mode="wait">
        {filteredProjects.length > 0 ? (
          <ProjectsGridContainer
            as={motion.div}
            variants={staggerContainerVariant}
            initial="hidden"
            animate="visible"
            key="projects"
          >
            {filteredProjects.map((project) => (
              <motion.div key={project._id} variants={staggerItemVariant}>
                <ProjectCard project={project} />
              </motion.div>
            ))}
          </ProjectsGridContainer>
        ) : (
          <EmptyState
            as={motion.div}
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            key="empty"
          >
            <p>No projects found matching your criteria.</p>
            <button onClick={() => { setSearchQuery(''); setSelectedTech(null); }}>
              Clear filters
            </button>
          </EmptyState>
        )}
      </AnimatePresence>
    </GridWrapper>
  );
};
```

### Project Card Component

#### `src/components/UI/ProjectsPage/ProjectCard.tsx`
```typescript
'use client';

import React from 'react';
import Link from 'next/link';
import Image from 'next/image';
import { motion } from 'framer-motion';
import { Tag } from '@/components/Common';
import { urlForImage } from '@/sanity/lib/image';
import { hoverLift } from '@/styles';
import type { ProjectListItem } from '@/types/sanity';
import {
  CardWrapper,
  CardImageWrapper,
  CardContent,
  CardTitle,
  CardDescription,
  CardTags,
  CardMeta,
} from './styles';

interface ProjectCardProps {
  project: ProjectListItem;
}

const ProjectCard: React.FC<ProjectCardProps> = ({ project }) => {
  const imageUrl = project.featuredImage
    ? urlForImage(project.featuredImage)?.width(600).height(400).url()
    : null;

  return (
    <CardWrapper
      as={motion(Link)}
      href={`/projects/${project.slug.current}`}
      whileHover={hoverLift}
      data-testid="project-card"
    >
      <CardImageWrapper>
        {imageUrl ? (
          <Image
            src={imageUrl}
            alt={project.featuredImage?.alt || project.title}
            fill
            sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
            style={{ objectFit: 'cover' }}
          />
        ) : (
          <div className="placeholder" />
        )}
      </CardImageWrapper>

      <CardContent>
        <CardTitle>{project.title}</CardTitle>
        <CardDescription>{project.description}</CardDescription>

        {project.techStack && project.techStack.length > 0 && (
          <CardTags>
            {project.techStack.slice(0, 4).map((tech) => (
              <Tag key={tech} variant="outline">
                {tech}
              </Tag>
            ))}
            {project.techStack.length > 4 && (
              <Tag variant="outline">+{project.techStack.length - 4}</Tag>
            )}
          </CardTags>
        )}

        {project.clientName && (
          <CardMeta>Client: {project.clientName}</CardMeta>
        )}
      </CardContent>
    </CardWrapper>
  );
};

export default ProjectCard;
```

---

## Styles

#### `src/components/UI/ProjectsPage/styles.ts`
```typescript
import styled from 'styled-components';
import { flexColumn, lineClamp } from '@/styles';

export const GridWrapper = styled.div`
  ${flexColumn}
  gap: ${({ theme }) => theme.spacing[8]};
`;

export const FiltersWrapper = styled.div`
  ${flexColumn}
  gap: ${({ theme }) => theme.spacing[4]};
`;

export const SearchWrapper = styled.div`
  max-width: 400px;
`;

export const TagFilters = styled.div`
  display: flex;
  flex-wrap: wrap;
  gap: ${({ theme }) => theme.spacing[2]};
`;

export const ProjectsGridContainer = styled.div`
  display: grid;
  grid-template-columns: 1fr;
  gap: ${({ theme }) => theme.spacing[6]};

  @media (min-width: ${({ theme }) => theme.breakpoints.sm}) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: ${({ theme }) => theme.breakpoints.lg}) {
    grid-template-columns: repeat(3, 1fr);
  }
`;

export const CardWrapper = styled.a`
  ${flexColumn}
  background-color: ${({ theme }) => theme.colors.backgroundLight};
  border-radius: ${({ theme }) => theme.borderRadius.xl};
  overflow: hidden;
  text-decoration: none;
  color: inherit;
  transition: all ${({ theme }) => theme.transitions.normal};

  &:hover {
    box-shadow: ${({ theme }) => theme.shadows.lg};
  }
`;

export const CardImageWrapper = styled.div`
  position: relative;
  aspect-ratio: 16 / 10;
  background-color: ${({ theme }) => theme.colors.backgroundAlt};

  .placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(
      135deg,
      ${({ theme }) => theme.colors.backgroundAlt} 0%,
      ${({ theme }) => theme.colors.backgroundLight} 100%
    );
  }
`;

export const CardContent = styled.div`
  ${flexColumn}
  gap: ${({ theme }) => theme.spacing[3]};
  padding: ${({ theme }) => theme.spacing[5]};
`;

export const CardTitle = styled.h3`
  font-size: ${({ theme }) => theme.fontSizes.lg};
  font-weight: ${({ theme }) => theme.fontWeights.semibold};
  color: ${({ theme }) => theme.colors.white};
`;

export const CardDescription = styled.p`
  ${lineClamp(2)}
  color: ${({ theme }) => theme.colors.mediumGray};
  font-size: ${({ theme }) => theme.fontSizes.sm};
`;

export const CardTags = styled.div`
  display: flex;
  flex-wrap: wrap;
  gap: ${({ theme }) => theme.spacing[2]};
  margin-top: ${({ theme }) => theme.spacing[2]};
`;

export const CardMeta = styled.span`
  font-size: ${({ theme }) => theme.fontSizes.xs};
  color: ${({ theme }) => theme.colors.darkGray};
`;

export const EmptyState = styled.div`
  text-align: center;
  padding: ${({ theme }) => theme.spacing[12]};
  color: ${({ theme }) => theme.colors.mediumGray};

  button {
    margin-top: ${({ theme }) => theme.spacing[4]};
    color: ${({ theme }) => theme.colors.primary};
    background: none;
    border: none;
    cursor: pointer;
    text-decoration: underline;
  }
`;
```

---

## Acceptance Criteria

- [ ] Page fetches projects from Sanity
- [ ] Projects display in responsive grid
- [ ] Search filters projects by title/description
- [ ] Tech tag filters work correctly
- [ ] Project cards link to detail pages
- [ ] Images load with Next.js Image optimization
- [ ] Empty state shows when no results
- [ ] CTA section links to consultation
- [ ] Page is fully responsive
- [ ] SEO metadata is set
- [ ] All tests pass
- [ ] `npm run lint` passes
- [ ] `npm run build` succeeds

---

## On Completion

1. Update `EXECUTION.md`: Mark T013 as `completed`
2. Commit: `git commit -m "T013: Add projects listing page with search and filtering"`
