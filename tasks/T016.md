# T016: SEO Implementation

## Overview

**Task ID**: T016
**Phase**: 4 - Integrations
**Priority**: High
**Dependencies**: T008-T014 (All pages)
**Estimated Complexity**: Medium

## Objective

Implement comprehensive SEO for the website including metadata, Open Graph tags, sitemap generation, robots.txt, JSON-LD structured data, and canonical URLs.

---

## Prerequisites

Before starting this task:
1. Read `CLAUDE.md` for agent rules
2. Check `EXECUTION.md` - Ensure T008-T014 are `completed`
3. Mark this task as `in_progress` in `EXECUTION.md`
4. Read `SHARED_NOTES.md` for any relevant notes

---

## File Ownership

```
CREATE:
- src/app/sitemap.ts
- src/app/robots.ts
- src/lib/seo/metadata.ts
- src/lib/seo/jsonld.ts
- src/lib/seo/index.ts
- src/__tests__/lib/seo/metadata.test.ts
- src/__tests__/lib/seo/jsonld.test.ts

MODIFY (metadata exports only):
- src/app/layout.tsx (root metadata)
- src/app/(home)/page.tsx
- src/app/services/page.tsx
- src/app/projects/page.tsx
- src/app/about/page.tsx
- src/app/contact/page.tsx
- src/app/book-consultation/page.tsx
```

---

## Implementation

### Sitemap Generator

#### `src/app/sitemap.ts`
```typescript
import { MetadataRoute } from 'next';
import { getProjectSlugs } from '@/sanity/lib/fetch';

const BASE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'https://xerence.com';

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  // Static pages
  const staticPages: MetadataRoute.Sitemap = [
    {
      url: BASE_URL,
      lastModified: new Date(),
      changeFrequency: 'weekly',
      priority: 1,
    },
    {
      url: `${BASE_URL}/services`,
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 0.9,
    },
    {
      url: `${BASE_URL}/projects`,
      lastModified: new Date(),
      changeFrequency: 'weekly',
      priority: 0.8,
    },
    {
      url: `${BASE_URL}/about`,
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 0.7,
    },
    {
      url: `${BASE_URL}/contact`,
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 0.7,
    },
    {
      url: `${BASE_URL}/book-consultation`,
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 0.9,
    },
  ];

  // Dynamic project pages
  const projectSlugs = await getProjectSlugs();
  const projectPages: MetadataRoute.Sitemap = projectSlugs.map((slug) => ({
    url: `${BASE_URL}/projects/${slug}`,
    lastModified: new Date(),
    changeFrequency: 'monthly' as const,
    priority: 0.6,
  }));

  return [...staticPages, ...projectPages];
}
```

### Robots.txt Generator

#### `src/app/robots.ts`
```typescript
import { MetadataRoute } from 'next';

const BASE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'https://xerence.com';

export default function robots(): MetadataRoute.Robots {
  return {
    rules: [
      {
        userAgent: '*',
        allow: '/',
        disallow: ['/studio/', '/api/'],
      },
    ],
    sitemap: `${BASE_URL}/sitemap.xml`,
  };
}
```

### Metadata Utilities

#### `src/lib/seo/metadata.ts`
```typescript
import { Metadata } from 'next';

const BASE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'https://xerence.com';

export interface PageMetadata {
  title: string;
  description: string;
  path: string;
  image?: string;
  noIndex?: boolean;
}

export const createMetadata = ({
  title,
  description,
  path,
  image,
  noIndex = false,
}: PageMetadata): Metadata => {
  const url = `${BASE_URL}${path}`;
  const fullTitle = path === '/' ? title : `${title} | Xerence Innovations`;
  const ogImage = image || `${BASE_URL}/og-image.png`;

  return {
    title: fullTitle,
    description,
    metadataBase: new URL(BASE_URL),
    alternates: {
      canonical: url,
    },
    openGraph: {
      title: fullTitle,
      description,
      url,
      siteName: 'Xerence Innovations',
      locale: 'en_US',
      type: 'website',
      images: [
        {
          url: ogImage,
          width: 1200,
          height: 630,
          alt: title,
        },
      ],
    },
    twitter: {
      card: 'summary_large_image',
      title: fullTitle,
      description,
      images: [ogImage],
    },
    robots: noIndex
      ? { index: false, follow: false }
      : { index: true, follow: true },
  };
};

export const rootMetadata: Metadata = {
  metadataBase: new URL(BASE_URL),
  title: {
    default: 'Xerence Innovations | Building Intelligent Software',
    template: '%s | Xerence Innovations',
  },
  description:
    'Xerence Innovations builds custom software, mobile apps, and AI solutions. Transform your ideas into reality with our expert team.',
  keywords: [
    'software development',
    'custom software',
    'mobile app development',
    'AI solutions',
    'machine learning',
    'cloud infrastructure',
    'web development',
    'tech consulting',
  ],
  authors: [{ name: 'Xerence Innovations' }],
  creator: 'Xerence Innovations',
  publisher: 'Xerence Innovations',
  formatDetection: {
    email: false,
    address: false,
    telephone: false,
  },
  openGraph: {
    type: 'website',
    locale: 'en_US',
    siteName: 'Xerence Innovations',
  },
  twitter: {
    card: 'summary_large_image',
    site: '@xerence',
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      'max-video-preview': -1,
      'max-image-preview': 'large',
      'max-snippet': -1,
    },
  },
  verification: {
    // Add verification codes when available
    // google: 'verification_code',
    // yandex: 'verification_code',
  },
};
```

### JSON-LD Structured Data

#### `src/lib/seo/jsonld.ts`
```typescript
const BASE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'https://xerence.com';

export interface OrganizationJsonLd {
  '@context': 'https://schema.org';
  '@type': 'Organization';
  name: string;
  url: string;
  logo: string;
  description: string;
  contactPoint: {
    '@type': 'ContactPoint';
    email: string;
    contactType: string;
  };
  sameAs: string[];
}

export const organizationJsonLd: OrganizationJsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: 'Xerence Innovations',
  url: BASE_URL,
  logo: `${BASE_URL}/logo.png`,
  description:
    'Xerence Innovations builds custom software, mobile apps, and AI solutions.',
  contactPoint: {
    '@type': 'ContactPoint',
    email: 'hello@xerence.com',
    contactType: 'customer service',
  },
  sameAs: [
    'https://twitter.com/xerence',
    'https://linkedin.com/company/xerence',
    'https://github.com/xerence',
  ],
};

export interface WebsiteJsonLd {
  '@context': 'https://schema.org';
  '@type': 'WebSite';
  name: string;
  url: string;
  potentialAction: {
    '@type': 'SearchAction';
    target: string;
    'query-input': string;
  };
}

export const websiteJsonLd: WebsiteJsonLd = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Xerence Innovations',
  url: BASE_URL,
  potentialAction: {
    '@type': 'SearchAction',
    target: `${BASE_URL}/projects?search={search_term_string}`,
    'query-input': 'required name=search_term_string',
  },
};

export interface ServiceJsonLd {
  '@context': 'https://schema.org';
  '@type': 'Service';
  name: string;
  description: string;
  provider: {
    '@type': 'Organization';
    name: string;
  };
  serviceType: string;
}

export const createServiceJsonLd = (
  name: string,
  description: string,
  serviceType: string
): ServiceJsonLd => ({
  '@context': 'https://schema.org',
  '@type': 'Service',
  name,
  description,
  provider: {
    '@type': 'Organization',
    name: 'Xerence Innovations',
  },
  serviceType,
});

export interface ProjectJsonLd {
  '@context': 'https://schema.org';
  '@type': 'CreativeWork';
  name: string;
  description: string;
  url: string;
  image?: string;
  creator: {
    '@type': 'Organization';
    name: string;
  };
}

export const createProjectJsonLd = (
  name: string,
  description: string,
  slug: string,
  image?: string
): ProjectJsonLd => ({
  '@context': 'https://schema.org',
  '@type': 'CreativeWork',
  name,
  description,
  url: `${BASE_URL}/projects/${slug}`,
  image,
  creator: {
    '@type': 'Organization',
    name: 'Xerence Innovations',
  },
});

// Helper to render JSON-LD script
export const renderJsonLd = (data: Record<string, unknown>): string => {
  return JSON.stringify(data);
};
```

### Index Export

#### `src/lib/seo/index.ts`
```typescript
export { createMetadata, rootMetadata } from './metadata';
export type { PageMetadata } from './metadata';

export {
  organizationJsonLd,
  websiteJsonLd,
  createServiceJsonLd,
  createProjectJsonLd,
  renderJsonLd,
} from './jsonld';
export type {
  OrganizationJsonLd,
  WebsiteJsonLd,
  ServiceJsonLd,
  ProjectJsonLd,
} from './jsonld';
```

### JSON-LD Component for Layout

Add to `src/app/layout.tsx`:

```typescript
import { organizationJsonLd, websiteJsonLd, renderJsonLd } from '@/lib/seo';

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <head>
        <script
          type="application/ld+json"
          dangerouslySetInnerHTML={{
            __html: renderJsonLd(organizationJsonLd),
          }}
        />
        <script
          type="application/ld+json"
          dangerouslySetInnerHTML={{
            __html: renderJsonLd(websiteJsonLd),
          }}
        />
      </head>
      <body>{children}</body>
    </html>
  );
}
```

---

## Page Metadata Examples

### Homepage

```typescript
import { createMetadata } from '@/lib/seo';

export const metadata = createMetadata({
  title: 'Xerence Innovations | Building Intelligent Software',
  description: 'Transform your ideas into reality with custom software, mobile apps, and AI solutions. Book a free consultation today.',
  path: '/',
});
```

### Services Page

```typescript
export const metadata = createMetadata({
  title: 'Services',
  description: 'End-to-end software development services including custom software, mobile apps, AI/ML solutions, cloud infrastructure, and more.',
  path: '/services',
});
```

---

## Tests

#### `src/__tests__/lib/seo/metadata.test.ts`
```typescript
import { createMetadata } from '@/lib/seo/metadata';

describe('SEO Metadata', () => {
  it('should create metadata with correct title format', () => {
    const metadata = createMetadata({
      title: 'Test Page',
      description: 'Test description',
      path: '/test',
    });

    expect(metadata.title).toBe('Test Page | Xerence Innovations');
  });

  it('should not append suffix for homepage', () => {
    const metadata = createMetadata({
      title: 'Xerence Innovations',
      description: 'Homepage',
      path: '/',
    });

    expect(metadata.title).toBe('Xerence Innovations');
  });

  it('should set canonical URL', () => {
    const metadata = createMetadata({
      title: 'Test',
      description: 'Test',
      path: '/test',
    });

    expect(metadata.alternates?.canonical).toContain('/test');
  });

  it('should set OpenGraph data', () => {
    const metadata = createMetadata({
      title: 'Test',
      description: 'Test description',
      path: '/test',
    });

    expect(metadata.openGraph?.title).toBe('Test | Xerence Innovations');
    expect(metadata.openGraph?.description).toBe('Test description');
  });

  it('should handle noIndex flag', () => {
    const metadata = createMetadata({
      title: 'Private',
      description: 'Private page',
      path: '/private',
      noIndex: true,
    });

    expect(metadata.robots).toEqual({ index: false, follow: false });
  });
});
```

#### `src/__tests__/lib/seo/jsonld.test.ts`
```typescript
import {
  organizationJsonLd,
  websiteJsonLd,
  createServiceJsonLd,
  createProjectJsonLd,
} from '@/lib/seo/jsonld';

describe('JSON-LD Structured Data', () => {
  describe('organizationJsonLd', () => {
    it('should have correct type', () => {
      expect(organizationJsonLd['@type']).toBe('Organization');
    });

    it('should have required fields', () => {
      expect(organizationJsonLd.name).toBe('Xerence Innovations');
      expect(organizationJsonLd.url).toBeDefined();
      expect(organizationJsonLd.contactPoint).toBeDefined();
    });
  });

  describe('websiteJsonLd', () => {
    it('should have correct type', () => {
      expect(websiteJsonLd['@type']).toBe('WebSite');
    });

    it('should have search action', () => {
      expect(websiteJsonLd.potentialAction['@type']).toBe('SearchAction');
    });
  });

  describe('createServiceJsonLd', () => {
    it('should create service with correct type', () => {
      const service = createServiceJsonLd(
        'Custom Software',
        'Description',
        'SoftwareDevelopment'
      );
      expect(service['@type']).toBe('Service');
      expect(service.name).toBe('Custom Software');
    });
  });

  describe('createProjectJsonLd', () => {
    it('should create project with correct URL', () => {
      const project = createProjectJsonLd(
        'Test Project',
        'Description',
        'test-project'
      );
      expect(project['@type']).toBe('CreativeWork');
      expect(project.url).toContain('/projects/test-project');
    });
  });
});
```

---

## Acceptance Criteria

- [ ] Sitemap.xml generates correctly at /sitemap.xml
- [ ] Robots.txt generates correctly at /robots.txt
- [ ] All pages have proper metadata
- [ ] Open Graph tags render correctly
- [ ] Twitter cards render correctly
- [ ] Canonical URLs are set
- [ ] JSON-LD structured data validates
- [ ] No duplicate titles or descriptions
- [ ] All tests pass
- [ ] `npm run lint` passes
- [ ] `npm run build` succeeds

---

## Verification

Test with these tools:
- Google Rich Results Test
- Facebook Sharing Debugger
- Twitter Card Validator
- Schema.org Validator

---

## On Completion

1. Update `EXECUTION.md`: Mark T016 as `completed`
2. Commit: `git commit -m "T016: Add comprehensive SEO with sitemap, robots.txt, and structured data"`
